@namespace SGE.UI.Components
@using SGE.Aplicacion.CasosDeUso.Expediente
@using SGE.Aplicacion.Entidades
@using SGE.UI
@inject NavigationManager Navigation
@inject CasoDeUsoExpedienteConsultaTodos expConsultaTodos
@rendermode InteractiveServer
@page "/expedientes/{usuario}"

<h3>expedientes</h3>

@if (usuario==null)
{
    Navigation.NavigateTo("/login");
}
else if (!hayExpedientes)
{
    <p>Cargando....</p>
}
else
{
    <input @bind=@idExpediente placeholder="buscar por id" />
    <button @onclick="BuscarPorId"/>
    <PopUpBuscar id=@idExpediente usuario=@usuario/>
    <PagListaExpediente Expe=@expedientes User=@usuario/>
    @if (!puedeVer)
    {
        <p>no tienes los permisos suficientes</p>
    }
}

@code {
    [Parameter]
    public Usuario? usuario { get; set; }
    private bool hayExpedientes = true;
    private bool puedeVer = true;
    private int idExpediente;
    private List<Expediente>? expedientes { get; set; }
    PopUpEditar popUpEditar = null!;
    PopUpBuscar popUpBuscar = null!;


    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);
        //cambiar idUsuario a int y hacer una busqueda por id en el repositorio de usuarios para obtener los permisos
        //cambiar los permisos dependiendo de que es lo que pueda hacer el usuario
        expedientes = expConsultaTodos.Ejecutar();
    }
    private void EditarOk()
    {
        popUpEditar.Mostrar();
    }
    private void BuscarPorId()
    {
        popUpBuscar.Mostrar();
    }
}
